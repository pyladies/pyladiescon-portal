{% extends "portal/base.html" %}
{% load allauth i18n %}
{% load django_bootstrap5 %}
{% load volunteer_tags %}
{% block body %}
{% endblock body %}
{% block content %}
    <h1 class="display-5 mb-4">
        {% if user.is_superuser and user.username != object.user.username %}
            Volunteer Profile for:  {{ object.user.username }}
        {% else %}
            Your Volunteer Profile
        {% endif %}
        <span class="badge bg-info text-dark me-1">{{ object.application_status }}</span>
    </h1>
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                {% trans "Basic Information" %}
            </h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    {% trans "Username:" %}
                </div>
                <div class="col-md-9">
                    {{ object.user.username }}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    {% trans "Name:" %}
                </div>
                <div class="col-md-9">
                    {{ object.user.first_name }} {{ object.user.last_name }}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    {% trans "Email:" %}
                </div>
                <div class="col-md-9">
                    {{ object.user.email }}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    {% trans "Availability:" %}
                </div>
                <div class="col-md-9">
                    {{ object.availability_hours_per_week|default:0 }} hours per week
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    {% trans "Region:" %}
                </div>
                <div class="col-md-9">
                    {{ object.region|default:"Not specified" }}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    {% trans "PyLadies Chapter:" %}
                </div>
                <div class="col-md-9">
                    {{ object.chapter|default:"Not specified" }}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    Languages:
                </div>
                <div class="col-md-9">
                    {% volunteer_languages_badges object %}
                </div>
            </div>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                {% trans "Teams & Roles" %}
            </h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    {% trans "Teams:" %}
                </div>
                <div class="col-md-9">
                    {% if object.teams.all %}
                        {% for team in object.teams.all %}
                            <span class="badge bg-primary me-1">{{ team.short_name }}</span>
                        {% endfor %}
                    {% else %}
                        {% trans "Not assigned to any teams yet" %}
                    {% endif %}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-bold">
                    Roles:
                </div>
                <div class="col-md-9">
                    {% if object.roles.all %}
                        {% for role in object.roles.all %}
                            <span class="badge bg-secondary me-1">{{ role.short_name }}</span>
                        {% endfor %}
                    {% else %}
                        {% trans "No roles assigned yet" %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                Social Media
            </h5>
        </div>
        <div class="card-body">
            {% if object.github_username or object.discord_username or object.instagram_username or object.bluesky_username or object.mastodon_url or object.x_username or object.linkedin_url %}
                {% if object.github_username %}
                    <div class="row mb-2">
                        <div class="col-md-3 fw-bold">
                            GitHub:
                        </div>
                        <div class="col-md-9">
                            <a href="https://github.com/{{ object.github_username }}">{{ object.github_username }}</a>
                        </div>
                    </div>
                {% endif %}
                {% if object.discord_username %}
                    <div class="row mb-2">
                        <div class="col-md-3 fw-bold">
                            Discord:
                        </div>
                        <div class="col-md-9">
                            {{ object.discord_username }}
                        </div>
                    </div>
                {% endif %}
                {% if object.instagram_username %}
                    <div class="row mb-2">
                        <div class="col-md-3 fw-bold">
                            Instagram:
                        </div>
                        <div class="col-md-9">
                            {{ object.instagram_username }}
                        </div>
                    </div>
                {% endif %}
                {% if object.bluesky_username %}
                    <div class="row mb-2">
                        <div class="col-md-3 fw-bold">
                            Bluesky:
                        </div>
                        <div class="col-md-9">
                            {{ object.bluesky_username }}
                        </div>
                    </div>
                {% endif %}
                {% if object.mastodon_url %}
                    <div class="row mb-2">
                        <div class="col-md-3 fw-bold">
                            Mastodon:
                        </div>
                        <div class="col-md-9">
                            {{ object.mastodon_url }}
                        </div>
                    </div>
                {% endif %}
                {% if object.x_username %}
                    <div class="row mb-2">
                        <div class="col-md-3 fw-bold">
                            X/Twitter:
                        </div>
                        <div class="col-md-9">
                            {{ object.x_username }}
                        </div>
                    </div>
                {% endif %}
                {% if object.linkedin_url %}
                    <div class="row mb-2">
                        <div class="col-md-3 fw-bold">
                            LinkedIn:
                        </div>
                        <div class="col-md-9">
                            {{ object.linkedin_url }}
                        </div>
                    </div>
                {% endif %}
            {% else %}
                <p>
                    {% trans "No social media profiles added" %}
                </p>
            {% endif %}
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                {% trans "Additional Comments" %}
            </h5>
        </div>
        <div class="card-body">
            <p>
                {{ object.additional_comments }}
            </p>
        </div>
    </div>
    <div class="mt-4">
        {% if user.is_superuser and user.username != object.user.username %}
            <a class="btn btn-secondary"
               href="{% url 'volunteer:volunteers_list' %}">Back to Manage Volunteers</a>
            {% if object.application_status != "Cancelled" %}
                <button type="button"
                        class="btn btn-danger ms-2"
                        data-bs-toggle="modal"
                        data-bs-target="#cancelVolunteeringModal">
                    Cancel Volunteering
                </button>
            {% endif %}
        {% else %}
            {% if object.application_status != "Cancelled" %}
                <a class="btn btn-primary"
                   href="{% url 'volunteer:volunteer_profile_edit' object.pk %}">Edit Profile</a>
                <button type="button"
                        class="btn btn-danger ms-2"
                        data-bs-toggle="modal"
                        data-bs-target="#cancelVolunteeringModal">
                    Cancel My Volunteering
                </button>
            {% endif %}
            <a class="btn btn-secondary" href="{% url 'volunteer:index' %}">Back to Volunteer Dashboard</a>
        {% endif %}
    </div>
    <!-- Cancel Volunteering Modal -->
    {% if object.application_status != "Cancelled" %}
        <div class="modal fade"
             id="cancelVolunteeringModal"
             tabindex="-1"
             aria-labelledby="cancelVolunteeringModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="cancelVolunteeringModalLabel">
                            Cancel Volunteering
                        </h5>
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close">
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>
                            <strong>Are you sure you want to cancel your volunteer application?</strong>
                        </p>
                        <p>
                            This action will:
                        </p>
                        <ul>
                            <li>
                                Set your application status to "Cancelled"
                            </li>
                            <li>
                                Remove you from all assigned teams and roles
                            </li>
                            <li>
                                Send a confirmation email to you
                            </li>
                            <li>
                                Notify team leads about your departure
                            </li>
                        </ul>
                        <p class="text-danger">
                            <strong>This action cannot be undone.</strong> If you change your mind, you'll need to submit a new volunteer application.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            Keep Volunteering
                        </button>
                        <form method="post"
                              action="{% url 'volunteer:cancel_volunteering' object.pk %}"
                              class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">
                                Yes, Cancel My Volunteering
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock content %}
